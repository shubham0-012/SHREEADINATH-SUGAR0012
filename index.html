<!DOCTYPE html>
<html lang="mr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>SHREE ADINATH SUGAR FACTORY - Multi-Login & MultiLang</title>

<style>
  body { font-family: Arial, sans-serif; margin:0; background:#f7f7f7; color:#333;}
  .container { max-width: 960px; margin: auto; padding: 15px;}
  h2, h3 { margin-top:10px; }
  input, select, button { padding: 8px 12px; margin: 4px 2px; border-radius: 4px; border: 1px solid #ccc; font-size: 14px; }
  button { background-color:#1976d2; color: white; border:none; cursor:pointer; }
  button:hover { background-color: #135ca6; }
  .btn-danger { background-color:#dc3545; }
  .btn-danger:hover { background-color:#a52330; }
  .btn-success { background-color: #198754; }
  .btn-success:hover { background-color: #136f44; }
  .btn-warning { background-color: #ffc107; color: #333; }
  .btn-warning:hover { background-color: #d19f07; }
  .hidden { display: none !important; }
  .message { font-weight: 600; margin: 8px 0; }
  .error { color: #dc3545; }
  .success { color: #198754; }
  table { border-collapse: collapse; width: 100%; margin-top: 8px; font-size: 14px; }
  th, td { border: 1px solid #ccc; padding: 7px 10px; text-align: left; }
  th { background-color: #e9ecef; }
  .grid { display: grid; grid-template-columns: repeat(10,1fr); gap: 6px; margin-top: 10px; margin-bottom: 15px;}
  .slot-box { padding: 8px; border: 1px solid #999; border-radius: 5px; text-align: center; font-size: 14px; min-height: 60px; background: #e7f3e7; }
  .occupied { background: #ffebeb; border-color: #dc3545; position: relative; }
  .occupied .tractor-icon { position: absolute; top: 6px; right: 6px; font-size: 18px; }
  #loginBox { max-width: 360px; margin: 50px auto; background: white; padding: 25px; border-radius: 8px; box-shadow: 0 0 12px #666; }
  #logoutBtn { float: right; margin: 10px 0; }
  #liveClock { font-weight: 600; }
  .lang-toggle { float: right; margin: 10px 5px; background: #444; color: white; padding: 5px 10px; cursor: pointer; border-radius: 4px;}
  .paid-bank { color: #198754; font-weight: bold; }
  .paid-cash { color: #ffc107; font-weight: bold; }
  .unpaid { color: #dc3545; font-weight: bold; }
  @media(max-width: 600px) {
    .grid { grid-template-columns: repeat(5,1fr); }
    input, select, button { width: 100%; box-sizing: border-box; margin: 5px 0; }
  }
</style>
</head>
<body>

<div class="container">

  <div id="loginBox">
    <h2 data-lang="loginTitle">üîê ‡§≤‡•â‡§ó‡§ø‡§® - ‡§∂‡§∞‡§ø ‡§Ü‡§¶‡§ø‡§®‡§æ‡§• ‡§∏‡§æ‡§ñ‡§∞ ‡§ï‡§æ‡§∞‡§ñ‡§æ‡§®‡§æ</h2>

    <label data-lang="selectRoleLabel">‡§∞‡•ã‡§≤ ‡§®‡§ø‡§µ‡§°‡§æ: </label>
    <select id="loginRole" onchange="updateLoginPlaceholders()">
      <option value="gateman">Gateman (‡§ó‡•á‡§ü‡§Æ‡•Ö‡§®)</option>
      <option value="chairman">Chairman (‡§ö‡•á‡§Ö‡§∞‡§Æ‡§®)</option>
      <option value="billing">Billing (‡§¨‡§ø‡§≤‡§ø‡§Ç‡§ó)</option>
      <option value="transport">Transport (‡§µ‡§æ‡§π‡§§‡•Ç‡§ï‡§¶‡§æ‡§∞)</option>
      <option value="farmer">Farmer (‡§∂‡•á‡§§‡§ï‡§∞‡•Ä)</option>
      <option value="tractorOwner">Tractor Owner (‡§ü‡•ç‡§∞‡•Ö‡§ï‡•ç‡§ü‡§∞ ‡§Æ‡§æ‡§≤‡§ï)</option>
    </select><br/>

    <input type="text" id="loginUser" placeholder="Username" autocomplete="off" /><br/>
    <input type="password" id="loginPass" placeholder="Password" autocomplete="off" /><br/>

    <div><label><input type="checkbox" id="showPass" /> <span data-lang="showPassword">‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§¶‡§æ‡§ñ‡§µ‡§æ</span></label></div>

    <button onclick="login()" data-lang="loginButton">Login</button>
    <p id="loginMessage" class="message error"></p>

    <p style="font-size:12px; color:#555;">
      ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§µ‡§æ‡§™‡§∞‡§ï‡§∞‡•ç‡§§‡•á: <br/>
      G (Gateman), C (Chairman), B (Billing), T (Transport) <br/>
      Farmer ‡§∏‡§æ‡§†‡•Ä - ‡§Ü‡§ß‡§æ‡§∞ ‡§®‡§Ç‡§¨‡§∞ (123456789012) ‡§Ü‡§£‡§ø ‡§™‡§æ‡§∏: 0012 <br/>
      Tractor Owner ‡§∏‡§æ‡§†‡•Ä - ‡§ü‡•ç‡§∞‡•Ö‡§ï‡•ç‡§ü‡§∞ ‡§®‡§Ç‡§¨‡§∞ (MH12AB1234) ‡§Ü‡§£‡§ø ‡§™‡§æ‡§∏: 0012 <br/>
    </p>

    <div class="lang-toggle" onclick="toggleLang()">‡§Æ‡§∞‡§æ‡§†‡•Ä / English</div>
  </div>

  <div id="mainApp" class="hidden">

    <button id="logoutBtn" onclick="logout()">üîÑ <span data-lang="logoutText">Switch User & Logout</span></button>
    <h2 data-lang="dashboardTitle">Dashboard - ‡§∂‡§∞‡§ø ‡§Ü‡§¶‡§ø‡§®‡§æ‡§• ‡§∏‡§æ‡§ñ‡§∞ ‡§ï‡§æ‡§∞‡§ñ‡§æ‡§®‡§æ</h2>

    <div>üïí <span id="liveClock"></span></div>

    <hr/>

    <div id="dashboardReport" style="font-weight:bold; margin-bottom:20px;"></div>

    <div>
      <b data-lang="parkingTitle">üöú ‡§™‡§æ‡§∞‡•ç‡§ï‡§ø‡§Ç‡§ó ‡§∏‡•ç‡§≤‡•â‡§ü ‡§Ü‡§£‡§ø ‡§∏‡§ß‡•ç‡§Ø‡§æ ‡§™‡§æ‡§∞‡•ç‡§ï ‡§ù‡§æ‡§≤‡•á‡§≤‡•á ‡§ü‡•ç‡§∞‡•Ö‡§ï‡•ç‡§ü‡§∞‡•ç‡§∏</b>
      <div class="grid" id="parkingGrid"></div>
    </div>

    <section id="gatemanSection" class="hidden" style="margin-top:20px;">
      <h3 data-lang="gatemanTitle">‡§ó‡•á‡§ü‡§Æ‡•Ö‡§®: ‡§ü‡•ç‡§∞‡•Ö‡§ï‡•ç‡§ü‡§∞ ‡§á‡§®/‡§Ü‡§â‡§ü ‡§Ü‡§£‡§ø ‡§™‡§æ‡§∞‡•ç‡§ï‡§ø‡§Ç‡§ó</h3>
      <input id="gatemanTractorNo" placeholder="Tractor Number (‡§â‡§¶‡§æ. MH01AB1234)" />
      <input id="gatemanSlot" type="number" min="1" max="50" placeholder="Parking Slot (1-50)" />
      <button onclick="tractorIn()" data-lang="tractorInBtn">Tractor In</button>
      <button onclick="tractorOut()" data-lang="tractorOutBtn">Tractor Out</button>
      <p id="gatemanMsg" class="message"></p>
    </section>

    <section id="chairmanSection" class="hidden" style="margin-top:20px;">
      <h3 data-lang="chairmanTitle">‡§ö‡•á‡§Ö‡§∞‡§Æ‡§®: ‡§ü‡•ç‡§∞‡•Ö‡§ï‡•ç‡§ü‡§∞ ‡§µ ‡§∂‡•á‡§§‡§ï‡§∞‡•Ä ‡§®‡•ã‡§Ç‡§¶‡§£‡•Ä ‡§Ü‡§£‡§ø ‡§µ‡•ç‡§Ø‡§µ‡§∏‡•ç‡§•‡§æ‡§™‡§®</h3>

      <div style="border:1px solid #ddd; background:#fff; padding:10px; border-radius:6px; margin-bottom:10px;">
        <h4 data-lang="rateTitle">‡§∞‡•á‡§ü ‡§µ‡•ç‡§Ø‡§µ‡§∏‡•ç‡§•‡§æ‡§™‡§® üí∞</h4>
        <label for="sugarcaneRate" data-lang="sugarcaneRateLabel">‡§ä‡§∏ ‡§¶‡§∞ (‡§™‡•ç‡§∞‡§§‡•Ä ‡§ü‡§®): </label>
        <input id="sugarcaneRate" type="number" value="2500" /><br/>
        <label for="transportRate" data-lang="transportRateLabel">‡§ü‡•ç‡§∞‡§æ‡§®‡•ç‡§∏‡§™‡•ã‡§∞‡•ç‡§ü ‡§¶‡§∞ (‡§™‡•ç‡§∞‡§§‡•Ä ‡§ï‡§ø‡§Æ‡•Ä): </label>
        <input id="transportRate" type="number" value="5" /><br/>
        <button onclick="saveRates()" data-lang="saveRatesBtn">‡§∏‡•á‡§µ‡•ç‡§π ‡§∞‡•á‡§ü‡•ç‡§∏</button>
        <p id="rateMsg" class="message"></p>
      </div>

      <div style="border:1px solid #ddd; background:#fff; padding:10px; border-radius:6px; margin-bottom:10px;">
        <h4 data-lang="tractorRegistration">üöú ‡§ü‡•ç‡§∞‡•Ö‡§ï‡•ç‡§ü‡§∞ ‡§®‡•ã‡§Ç‡§¶‡§£‡•Ä / ‡§∏‡§Ç‡§™‡§æ‡§¶‡§®</h4>
        <input id="chairmanTractorSearch" type="text" placeholder="Search Tractor Number..." onkeyup="filterTractors()"><br>
        <input id="chairmanOwner" placeholder="Owner Name" />
        <input id="chairmanTractorNo" placeholder="Tractor Number" />
        <input id="chairmanWeight" type="number" placeholder="Weight (kg)" />
        <input id="chairmanModel" placeholder="Model" />
        <button onclick="saveTractor()" data-lang="saveTractorBtn">Save Tractor</button>
        <input type="hidden" id="editingTractorIndex" value="-1" />
        <p id="tractorMsg" class="message"></p>
        <h5 data-lang="registeredTractors">‡§®‡•ã‡§Ç‡§¶‡§£‡•Ä‡§ï‡•É‡§§ ‡§ü‡•ç‡§∞‡•Ö‡§ï‡•ç‡§ü‡§∞‡•ç‡§∏</h5>
        <table id="tractorTable"><thead><tr><th data-lang="owner">Owner</th><th data-lang="number">Number</th><th data-lang="weight">Weight</th><th data-lang="model">Model</th><th data-lang="edit">Edit</th><th data-lang="delete">Delete</th></tr></thead><tbody></tbody></table>
      </div>

      <div style="border:1px solid #ddd; background:#fff; padding:10px; border-radius:6px; margin-bottom:10px;">
        <h4 data-lang="farmerRegistration">üë®‚Äçüåæ ‡§∂‡•á‡§§‡§ï‡§∞‡•Ä ‡§®‡•ã‡§Ç‡§¶‡§£‡•Ä / ‡§∏‡§Ç‡§™‡§æ‡§¶‡§®</h4>
        <input id="chairmanFarmerSearch" type="text" placeholder="Search Farmer Name..." onkeyup="filterFarmers()"><br>
        <input id="chairmanFarmerName" placeholder="Farmer Name" />
        <input id="chairmanFarmerAadhar" placeholder="Aadhar Number" />
        <input id="chairmanShetiGatNo" placeholder="Sheti Gat Number" />
        <input id="chairmanMobile" placeholder="Mobile Number" />
        <input id="chairmanAccountNo" placeholder="Account Number" />
        <input id="chairmanBankName" placeholder="Bank Name" />
        <input id="chairmanIFSC" placeholder="IFSC Code" />
        <button onclick="saveFarmer()" data-lang="saveFarmerBtn">Save Farmer</button>
        <input type="hidden" id="editingFarmerIndex" value="-1" />
        <p id="farmerMsg" class="message"></p>
        <h5 data-lang="registeredFarmers">‡§®‡•ã‡§Ç‡§¶‡§£‡•Ä‡§ï‡•É‡§§ ‡§∂‡•á‡§§‡§ï‡§∞‡•Ä</h5>
        <table id="farmerTable"><thead><tr><th data-lang="name">Name</th><th>Aadhar</th><th data-lang="mobile">Mobile</th><th data-lang="edit">Edit</th><th data-lang="delete">Delete</th></tr></thead><tbody></tbody></table>
      </div>

      <div>
        <h4 data-lang="inOutBook">üìù ‡§ü‡•ç‡§∞‡•Ö‡§ï‡•ç‡§ü‡§∞ ‡§á‡§®‡§Ü‡§â‡§ü ‡§¨‡•Å‡§ï</h4>
        <div style="max-height: 160px; overflow-y:auto;">
          <table id="inOutBookTable" border="1" style="width:100%; border-collapse: collapse;">
            <thead><tr><th>Tractor Number</th><th>Slot</th><th>In Time</th><th>Out Time</th></tr></thead><tbody></tbody>
          </table>
        </div>

        <h4 data-lang="farmerSalesBook" style="margin-top:15px;">üç¨ ‡§∂‡•á‡§§‡§ï‡§∞‡•Ä ‡§ä‡§∏ ‡§µ‡§ø‡§ï‡•ç‡§∞‡•Ä ‡§¨‡•Å‡§ï</h4>
        <div style="max-height: 160px; overflow-y:auto;">
          <table id="farmerSalesTable" border="1" style="width:100%; border-collapse: collapse;">
            <thead><tr><th>Farmer Name</th><th>Sugarcane Weight (tons)</th><th>Date</th></tr></thead><tbody></tbody>
          </table>
        </div>
      </div>

    </section>

    <section id="transportSection" class="hidden" style="margin-top:20px;">
      <h3 data-lang="transportTitle">üöö ‡§µ‡§æ‡§π‡§§‡•Ç‡§ï‡§¶‡§æ‡§∞ ‡§µ‡§ø‡§≠‡§æ‡§ó : ‡§∂‡•á‡§§‡§ï‡§∞‡•Ä ‡§Ü‡§£‡§ø ‡§ü‡•ç‡§∞‡§æ‡§®‡•ç‡§∏‡§™‡•ã‡§∞‡•ç‡§ü‡§∞‡§ö‡•á ‡§¨‡§ø‡§≤</h3>

      <select id="transportTractorSelect">
        <option value="">Select Tractor</option>
      </select><br/><br/>

      <input id="transportFarmerName" placeholder="Farmer Name" /><br/>
      <input id="transportSugarcaneWeight" type="number" placeholder="Sugarcane Weight (tons)" /><br/>
      <input id="transportDistance" type="number" placeholder="Distance Travelled (km)" /><br/>
      <input id="transportDiesel" type="number" placeholder="Diesel Given (litres)" /><br/>
     
      <button onclick="generateTransportBill()" data-lang="genTransportBillBtn">Generate Transport Owner Bill</button>
      <button onclick="generateFarmerBill()" data-lang="genFarmerBillBtn">Generate Farmer Bill</button>
      <p id="transportMsg" class="message"></p>

      <h4 data-lang="transportHistoryTitle" style="margin-top:15px;">üìã Transport History</h4>
      <div style="max-height: 180px; overflow-y:auto;">
        <table id="transportHistoryTable" border="1" style="width:100%; border-collapse: collapse;">
          <thead><tr><th>Tractor Number</th><th>Farmer Name</th><th>Weight (tons)</th><th>Distance (km)</th><th>Diesel (L)</th><th>Date</th></tr></thead><tbody></tbody>
        </table>
      </div>

      <div style="margin-top:10px;">
        <button onclick="printBill('transport')" data-lang="printTransportBtn">Print Transport Bill</button>
        <button onclick="printBill('farmer')" data-lang="printFarmerSalesBtn">Print Farmer Bill</button>
      </div>

    </section>
   
    <section id="billingSection" class="hidden" style="margin-top:20px;">
      <h3 data-lang="billingTitle">üí∞ ‡§¨‡§ø‡§≤‡§ø‡§Ç‡§ó ‡§µ‡§ø‡§≠‡§æ‡§ó - ‡§∂‡•á‡§§‡§ï‡§∞‡•Ä ‡§Ü‡§£‡§ø ‡§ü‡•ç‡§∞‡§æ‡§®‡•ç‡§∏‡§™‡•ã‡§∞‡•ç‡§ü ‡§¨‡§ø‡§≤ ‡§µ‡•ç‡§Ø‡§µ‡§∏‡•ç‡§•‡§æ‡§™‡§®</h3>
     
      <div style="border:1px solid #ddd; background:#fff; padding:10px; border-radius:6px; margin-bottom:10px;">
        <h4 data-lang="farmerBills">üë®‚Äçüåæ ‡§∂‡•á‡§§‡§ï‡§∞‡•Ä ‡§¨‡§ø‡§≤</h4>
        <div style="max-height: 250px; overflow-y:auto;">
          <table id="billingFarmerTable">
            <thead>
              <tr>
                <th>‡§®‡§æ‡§µ</th>
                <th>‡§µ‡§ú‡§® (‡§ü‡§®)</th>
                <th>‡§è‡§ï‡•Ç‡§£ ‡§∞‡§ï‡•ç‡§ï‡§Æ</th>
                <th>‡§∏‡•ç‡§•‡§ø‡§§‡•Ä</th>
                <th>‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
     
      <div style="border:1px solid #ddd; background:#fff; padding:10px; border-radius:6px; margin-bottom:10px;">
        <h4 data-lang="tractorBills">üöú ‡§ü‡•ç‡§∞‡•Ö‡§ï‡•ç‡§ü‡§∞ ‡§Æ‡§æ‡§≤‡§ï‡§æ‡§ö‡•á ‡§¨‡§ø‡§≤</h4>
        <div style="max-height: 250px; overflow-y:auto;">
          <table id="billingTractorTable">
            <thead>
              <tr>
                <th>‡§ü‡•ç‡§∞‡•Ö‡§ï‡•ç‡§ü‡§∞ ‡§®‡§Ç‡§¨‡§∞</th>
                <th>‡§è‡§ï‡•Ç‡§£ ‡§∞‡§ï‡•ç‡§ï‡§Æ</th>
                <th>‡§∏‡•ç‡§•‡§ø‡§§‡•Ä</th>
                <th>‡§ï‡•ç‡§∞‡§ø‡§Ø‡§æ</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>

    </section>

    <section id="farmerSection" class="hidden" style="margin-top:20px;">
      <h3 data-lang="farmerTitle">‡§∂‡•á‡§§‡§ï‡§∞‡•Ä - ‡§Ü‡§™‡§≤‡•á ‡§µ‡§ø‡§ï‡•ç‡§∞‡•Ä ‡§µ‡§ø‡§µ‡§∞‡§£ ‡§Ü‡§£‡§ø ‡§™‡§æ‡§∞‡•ç‡§ï‡§ø‡§Ç‡§ó ‡§Æ‡§æ‡§π‡§ø‡§§‡•Ä</h3>
      <p><b data-lang="welcomeFarmer">Welcome</b>, <span id="farmerLoginName"></span></p>

      <h4 data-lang="yourSales">‡§Ü‡§™‡§≤‡•ç‡§Ø‡§æ ‡§µ‡§ø‡§ï‡•ç‡§∞‡•Ä‡§ö‡•Ä ‡§Ø‡§æ‡§¶‡•Ä (Sugarcane Sales)</h4>
      <table id="farmerOwnSalesTable" border="1" style="width:100%; border-collapse: collapse;">
        <thead><tr><th>Weight (tons)</th><th>Bill Amount</th><th>Status</th><th>Date</th></tr></thead><tbody></tbody>
      </table>

      <h4 data-lang="yourSlots" style="margin-top:15px;">‡§Ü‡§™‡§≤‡•Ä ‡§ü‡•ç‡§∞‡•Ö‡§ï‡•ç‡§ü‡§∞ ‡§™‡§æ‡§∞‡•ç‡§ï‡§ø‡§Ç‡§ó ‡§Æ‡§æ‡§π‡§ø‡§§‡•Ä</h4>
      <table id="farmerTractorParkingTable" border="1" style="width:100%; border-collapse: collapse;">
        <thead><tr><th>Tractor Number</th><th>Slot</th><th>In Time</th><th>Out Time</th></tr></thead><tbody></tbody>
      </table>
    </section>

    <section id="tractorOwnerSection" class="hidden" style="margin-top:20px;">
      <h3 data-lang="tractorOwnerTitle">‡§ü‡•ç‡§∞‡•Ö‡§ï‡•ç‡§ü‡§∞ ‡§Æ‡§æ‡§≤‡§ï - ‡§Ü‡§™‡§≤‡•Ä ‡§ü‡•ç‡§∞‡•Ö‡§ï‡•ç‡§ü‡§∞ ‡§™‡§æ‡§∞‡•ç‡§ï‡§ø‡§Ç‡§ó ‡§µ ‡§™‡§∞‡§ø‡§ö‡§æ‡§≤‡§® ‡§Æ‡§æ‡§π‡§ø‡§§‡•Ä</h3>
      <p><b data-lang="welcomeOwner">Welcome</b>, <span id="tractorOwnerLoginName"></span></p>

      <h4 data-lang="yourTractors">‡§Ü‡§™‡§≤‡•á ‡§ü‡•ç‡§∞‡•Ö‡§ï‡•ç‡§ü‡§∞‡•ç‡§∏ ‡§Ü‡§£‡§ø ‡§§‡•ç‡§Ø‡§æ‡§Ç‡§ö‡•Ä ‡§™‡§æ‡§∞‡•ç‡§ï‡§ø‡§Ç‡§ó ‡§Æ‡§æ‡§π‡§ø‡§§‡•Ä</h4>
      <table id="ownerTractorParkingTable" border="1" style="width:100%; border-collapse: collapse;">
        <thead><tr><th>Number</th><th>Owner Bill</th><th>Status</th><th>In Time</th><th>Out Time</th></tr></thead><tbody></tbody>
      </table>
    </section>

  </div>

</div>

<script>
  // Data storage
  let tractorRegistry = JSON.parse(localStorage.getItem("tractorRegistry")) || [
      {owner: 'Ajit Patil', tractorNumber: 'MH12AB1234', weight: '1500', model: 'Swaraj'},
      {owner: 'Sandeep Mali', tractorNumber: 'MH13CD5678', weight: '1600', model: 'Eicher'}
  ];
  let farmerRegistry = JSON.parse(localStorage.getItem("farmerRegistry")) || [
      {name: 'Ramrao Yadav', aadhar: '123456789012', shetiGatNo: '55', mobile: '9876543210', accountNo: '12345', bankName: 'SBI', ifsc: 'SBIN0001'},
      {name: 'Shamrao Kadam', aadhar: '112233445566', shetiGatNo: '77', mobile: '8765432109', accountNo: '67890', bankName: 'BOI', ifsc: 'BOI0002'}
  ];
  let parkedTractors = JSON.parse(localStorage.getItem("parkedTractors")) || {};
  let inOutBook = JSON.parse(localStorage.getItem("inOutBook")) || [];
  let farmerSalesBook = JSON.parse(localStorage.getItem("farmerSalesBook")) || [];
  let transportHistory = JSON.parse(localStorage.getItem("transportHistory")) || [];
  let rates = JSON.parse(localStorage.getItem("rates")) || { sugarcane: 2500, transport: 5 };

  let currentRole = "";
  let loginUser = "";
  let currentLang = "mr"; // 'mr' or 'en'

  // Multilanguage dictionary
  const languageStrings = {
    mr: {
      loginTitle: "üîê ‡§≤‡•â‡§ó‡§ø‡§® - ‡§∂‡§∞‡§ø ‡§Ü‡§¶‡§ø‡§®‡§æ‡§• ‡§∏‡§æ‡§ñ‡§∞ ‡§ï‡§æ‡§∞‡§ñ‡§æ‡§®‡§æ",
      selectRoleLabel: "‡§∞‡•ã‡§≤ ‡§®‡§ø‡§µ‡§°‡§æ:",
      showPassword: "‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§¶‡§æ‡§ñ‡§µ‡§æ",
      loginButton: "‡§≤‡•â‡§ó‡§ø‡§®",
      logoutText: "‡§Ø‡•Å‡§ù‡§∞ ‡§∏‡•ç‡§µ‡§ø‡§ö ‡§ï‡§∞‡§æ ‡§µ ‡§¨‡§æ‡§π‡•á‡§∞ ‡§™‡§°‡§æ",
      dashboardTitle: "‡§°‡•Ö‡§∂‡§¨‡•ã‡§∞‡•ç‡§° - ‡§∂‡§∞‡§ø ‡§Ü‡§¶‡§ø‡§®‡§æ‡§• ‡§∏‡§æ‡§ñ‡§∞ ‡§ï‡§æ‡§∞‡§ñ‡§æ‡§®‡§æ",
      parkingTitle: "üöú ‡§™‡§æ‡§∞‡•ç‡§ï‡§ø‡§Ç‡§ó ‡§∏‡•ç‡§≤‡•â‡§ü ‡§Ü‡§£‡§ø ‡§∏‡§ß‡•ç‡§Ø‡§æ ‡§™‡§æ‡§∞‡•ç‡§ï ‡§ù‡§æ‡§≤‡•á‡§≤‡•á ‡§ü‡•ç‡§∞‡•Ö‡§ï‡•ç‡§ü‡§∞‡•ç‡§∏",
      gatemanTitle: "‡§ó‡•á‡§ü‡§Æ‡•Ö‡§®: ‡§ü‡•ç‡§∞‡•Ö‡§ï‡•ç‡§ü‡§∞ ‡§á‡§®/‡§Ü‡§â‡§ü ‡§Ü‡§£‡§ø ‡§™‡§æ‡§∞‡•ç‡§ï‡§ø‡§Ç‡§ó",
      tractorInBtn: "‡§ü‡•ç‡§∞‡•Ö‡§ï‡•ç‡§ü‡§∞ ‡§á‡§®",
      tractorOutBtn: "‡§ü‡•ç‡§∞‡•Ö‡§ï‡•ç‡§ü‡§∞ ‡§Ü‡§â‡§ü",
      chairmanTitle: "‡§ö‡•á‡§Ö‡§∞‡§Æ‡§®: ‡§ü‡•ç‡§∞‡•Ö‡§ï‡•ç‡§ü‡§∞ ‡§µ ‡§∂‡•á‡§§‡§ï‡§∞‡•Ä ‡§®‡•ã‡§Ç‡§¶‡§£‡•Ä ‡§Ü‡§£‡§ø ‡§µ‡•ç‡§Ø‡§µ‡§∏‡•ç‡§•‡§æ‡§™‡§®",
      rateTitle: "‡§∞‡•á‡§ü ‡§µ‡•ç‡§Ø‡§µ‡§∏‡•ç‡§•‡§æ‡§™‡§® üí∞",
      sugarcaneRateLabel: "‡§ä‡§∏ ‡§¶‡§∞ (‡§™‡•ç‡§∞‡§§‡•Ä ‡§ü‡§®):",
      transportRateLabel: "‡§ü‡•ç‡§∞‡§æ‡§®‡•ç‡§∏‡§™‡•ã‡§∞‡•ç‡§ü ‡§¶‡§∞ (‡§™‡•ç‡§∞‡§§‡•Ä ‡§ï‡§ø‡§Æ‡•Ä):",
      saveRatesBtn: "‡§∏‡•á‡§µ‡•ç‡§π ‡§∞‡•á‡§ü‡•ç‡§∏",
      tractorRegistration: "üöú ‡§ü‡•ç‡§∞‡•Ö‡§ï‡•ç‡§ü‡§∞ ‡§®‡•ã‡§Ç‡§¶‡§£‡•Ä / ‡§∏‡§Ç‡§™‡§æ‡§¶‡§®",
      saveTractorBtn: "‡§ü‡•ç‡§∞‡•Ö‡§ï‡•ç‡§ü‡§∞ ‡§®‡•ã‡§Ç‡§¶‡§µ‡§æ",
      registeredTractors: "‡§®‡•ã‡§Ç‡§¶‡§£‡•Ä‡§ï‡•É‡§§ ‡§ü‡•ç‡§∞‡•Ö‡§ï‡•ç‡§ü‡§∞‡•ç‡§∏",
      owner: "‡§Æ‡§æ‡§≤‡§ï",
      number: "‡§ï‡•ç‡§∞‡§Æ‡§æ‡§Ç‡§ï",
      weight: "‡§µ‡§ú‡§®",
      model: "‡§Æ‡•â‡§°‡•á‡§≤",
      edit: "‡§∏‡§Ç‡§™‡§æ‡§¶‡§®",
      delete: "‡§π‡§ü‡§µ‡§æ",
      farmerRegistration: "üë®‚Äçüåæ ‡§∂‡•á‡§§‡§ï‡§∞‡•Ä ‡§®‡•ã‡§Ç‡§¶‡§£‡•Ä / ‡§∏‡§Ç‡§™‡§æ‡§¶‡§®",
      saveFarmerBtn: "‡§∂‡•á‡§§‡§ï‡§∞‡•Ä ‡§®‡•ã‡§Ç‡§¶‡§µ‡§æ",
      registeredFarmers: "‡§®‡•ã‡§Ç‡§¶‡§£‡•Ä‡§ï‡•É‡§§ ‡§∂‡•á‡§§‡§ï‡§∞‡•Ä",
      name: "‡§®‡§æ‡§µ",
      mobile: "‡§Æ‡•ã‡§¨‡§æ‡§à‡§≤",
      inOutBook: "üìù ‡§ü‡•ç‡§∞‡•Ö‡§ï‡•ç‡§ü‡§∞ ‡§á‡§®‡§Ü‡§â‡§ü ‡§¨‡•Å‡§ï",
      farmerSalesBook: "üç¨ ‡§∂‡•á‡§§‡§ï‡§∞‡•Ä ‡§ä‡§∏ ‡§µ‡§ø‡§ï‡•ç‡§∞‡•Ä ‡§¨‡•Å‡§ï",
      transportTitle: "üöö ‡§µ‡§æ‡§π‡§§‡•Ç‡§ï‡§¶‡§æ‡§∞ ‡§µ‡§ø‡§≠‡§æ‡§ó : ‡§∂‡•á‡§§‡§ï‡§∞‡•Ä ‡§Ü‡§£‡§ø ‡§ü‡•ç‡§∞‡§æ‡§®‡•ç‡§∏‡§™‡•ã‡§∞‡•ç‡§ü‡§∞‡§ö‡•á ‡§¨‡§ø‡§≤",
      genTransportBillBtn: "‡§ü‡•ç‡§∞‡§æ‡§®‡•ç‡§∏‡§™‡•ã‡§∞‡•ç‡§ü ‡§Æ‡§æ‡§≤‡§ï ‡§¨‡§ø‡§≤ ‡§§‡§Ø‡§æ‡§∞ ‡§ï‡§∞‡§æ",
      genFarmerBillBtn: "‡§∂‡•á‡§§‡§ï‡§∞‡•Ä ‡§¨‡§ø‡§≤ ‡§§‡§Ø‡§æ‡§∞ ‡§ï‡§∞‡§æ",
      transportHistoryTitle: "üìã ‡§ü‡•ç‡§∞‡§æ‡§®‡•ç‡§∏‡§™‡•ã‡§∞‡•ç‡§ü ‡§á‡§§‡§ø‡§π‡§æ‡§∏",
      printTransportBtn: "‡§ü‡•ç‡§∞‡§æ‡§®‡•ç‡§∏‡§™‡•ã‡§∞‡•ç‡§ü ‡§¨‡§ø‡§≤ ‡§™‡•ç‡§∞‡§ø‡§Ç‡§ü ‡§ï‡§∞‡§æ",
      printFarmerSalesBtn: "‡§∂‡•á‡§§‡§ï‡§∞‡•Ä ‡§¨‡§ø‡§≤ ‡§™‡•ç‡§∞‡§ø‡§Ç‡§ü ‡§ï‡§∞‡§æ",
      billingTitle: "üí∞ ‡§¨‡§ø‡§≤‡§ø‡§Ç‡§ó ‡§µ‡§ø‡§≠‡§æ‡§ó - ‡§∂‡•á‡§§‡§ï‡§∞‡•Ä ‡§Ü‡§£‡§ø ‡§ü‡•ç‡§∞‡§æ‡§®‡•ç‡§∏‡§™‡•ã‡§∞‡•ç‡§ü ‡§¨‡§ø‡§≤ ‡§µ‡•ç‡§Ø‡§µ‡§∏‡•ç‡§•‡§æ‡§™‡§®",
      farmerBills: "üë®‚Äçüåæ ‡§∂‡•á‡§§‡§ï‡§∞‡•Ä ‡§¨‡§ø‡§≤",
      tractorBills: "üöú ‡§ü‡•ç‡§∞‡•Ö‡§ï‡•ç‡§ü‡§∞ ‡§Æ‡§æ‡§≤‡§ï‡§æ‡§ö‡•á ‡§¨‡§ø‡§≤",
      farmerTitle: "‡§∂‡•á‡§§‡§ï‡§∞‡•Ä - ‡§Ü‡§™‡§≤‡•á ‡§µ‡§ø‡§ï‡•ç‡§∞‡•Ä ‡§µ‡§ø‡§µ‡§∞‡§£ ‡§Ü‡§£‡§ø ‡§™‡§æ‡§∞‡•ç‡§ï‡§ø‡§Ç‡§ó ‡§Æ‡§æ‡§π‡§ø‡§§‡•Ä",
      welcomeFarmer: "‡§Ü‡§™‡§≤‡•á ‡§∏‡•ç‡§µ‡§æ‡§ó‡§§ ‡§Ü‡§π‡•á",
      yourSales: "‡§Ü‡§™‡§≤‡•ç‡§Ø‡§æ ‡§µ‡§ø‡§ï‡•ç‡§∞‡•Ä‡§ö‡•Ä ‡§Ø‡§æ‡§¶‡•Ä (Sugarcane Sales)",
      yourSlots: "‡§Ü‡§™‡§≤‡•Ä ‡§ü‡•ç‡§∞‡•Ö‡§ï‡•ç‡§ü‡§∞ ‡§™‡§æ‡§∞‡•ç‡§ï‡§ø‡§Ç‡§ó ‡§Æ‡§æ‡§π‡§ø‡§§‡•Ä",
      tractorOwnerTitle: "‡§ü‡•ç‡§∞‡•Ö‡§ï‡•ç‡§ü‡§∞ ‡§Æ‡§æ‡§≤‡§ï - ‡§Ü‡§™‡§≤‡•Ä ‡§ü‡•ç‡§∞‡•Ö‡§ï‡•ç‡§ü‡§∞ ‡§™‡§æ‡§∞‡•ç‡§ï‡§ø‡§Ç‡§ó ‡§µ ‡§™‡§∞‡§ø‡§ö‡§æ‡§≤‡§® ‡§Æ‡§æ‡§π‡§ø‡§§‡•Ä",
      welcomeOwner: "‡§Ü‡§™‡§≤‡•á ‡§∏‡•ç‡§µ‡§æ‡§ó‡§§ ‡§Ü‡§π‡•á",
      yourTractors: "‡§Ü‡§™‡§≤‡•á ‡§ü‡•ç‡§∞‡•Ö‡§ï‡•ç‡§ü‡§∞‡•ç‡§∏ ‡§Ü‡§£‡§ø ‡§§‡•ç‡§Ø‡§æ‡§Ç‡§ö‡•Ä ‡§™‡§æ‡§∞‡•ç‡§ï‡§ø‡§Ç‡§ó ‡§Æ‡§æ‡§π‡§ø‡§§‡•Ä",
      paidBank: "‡§¨‡§Å‡§ï‡•á‡§§‡•Ç‡§® ‡§™‡•à‡§∏‡•á ‡§¶‡§ø‡§≤‡•á",
      paidCash: "‡§ï‡•Ö‡§∂ ‡§¶‡§ø‡§≤‡•á",
      paidStatus: "‡§≠‡§∞‡§≤‡•á",
      cashStatus: "‡§ï‡•Ö‡§∂ ‡§¶‡§ø‡§≤‡•á",
      unpaidStatus: "‡§¶‡•á‡§Ø",
      markAsPaid: "‡§≠‡§∞‡§≤‡•á",
      markAsCash: "‡§ï‡•Ö‡§∂ ‡§¶‡§ø‡§≤‡•á",
      totalPaid: "‡§è‡§ï‡•Ç‡§£ ‡§≠‡§∞‡§≤‡•á‡§≤‡•á",
      totalUnpaid: "‡§è‡§ï‡•Ç‡§£ ‡§¶‡•á‡§Ø",
      bill: "‡§¨‡§ø‡§≤"
    },
    en: {
      loginTitle: "üîê Login - Shree Adinath Sugar Factory",
      selectRoleLabel: "Select Role:",
      showPassword: "Show Password",
      loginButton: "Login",
      logoutText: "Switch User & Logout",
      dashboardTitle: "Dashboard - Shree Adinath Sugar Factory",
      parkingTitle: "üöú Parking Slots and Currently Parked Tractors",
      gatemanTitle: "Gateman: Tractor In/Out and Parking",
      tractorInBtn: "Tractor In",
      tractorOutBtn: "Tractor Out",
      chairmanTitle: "Chairman: Tractor and Farmer Registration & Management",
      rateTitle: "Rate Management üí∞",
      sugarcaneRateLabel: "Sugarcane Rate (per ton):",
      transportRateLabel: "Transport Rate (per km):",
      saveRatesBtn: "Save Rates",
      tractorRegistration: "üöú Tractor Registration / Edit",
      saveTractorBtn: "Save Tractor",
      registeredTractors: "Registered Tractors",
      owner: "Owner",
      number: "Number",
      weight: "Weight",
      model: "Model",
      edit: "Edit",
      delete: "Delete",
      farmerRegistration: "üë®‚Äçüåæ Farmer Registration / Edit",
      saveFarmerBtn: "Save Farmer",
      registeredFarmers: "Registered Farmers",
      name: "Name",
      mobile: "Mobile",
      inOutBook: "üìù Tractor In-Out Book",
      farmerSalesBook: "üç¨ Farmer Sugarcane Sales Book",
      transportTitle: "üöö Transport Section: Farmer and Transporter Bills",
      genTransportBillBtn: "Generate Transport Owner Bill",
      genFarmerBillBtn: "Generate Farmer Bill",
      transportHistoryTitle: "üìã Transport History",
      printTransportBtn: "Print Transport Bill",
      printFarmerSalesBtn: "Print Farmer Bill",
      billingTitle: "üí∞ Billing Section - Farmer & Transport Bill Management",
      farmerBills: "üë®‚Äçüåæ Farmer Bills",
      tractorBills: "üöú Tractor Owner Bills",
      farmerTitle: "Farmer - Your Sales and Parking Info",
      welcomeFarmer: "Welcome",
      yourSales: "Your Sales List (Sugarcane Sales)",
      yourSlots: "Your Tractor Parking Info",
      tractorOwnerTitle: "Tractor Owner - Your Tractor Parking and Operations",
      welcomeOwner: "Welcome",
      yourTractors: "Your Tractors and Their Parking Info",
      paidBank: "Paid via Bank",
      paidCash: "Paid via Cash",
      paidStatus: "Paid",
      cashStatus: "Cash",
      unpaidStatus: "Unpaid",
      markAsPaid: "Mark as Paid",
      markAsCash: "Mark as Cash",
      totalPaid: "Total Paid",
      totalUnpaid: "Total Unpaid",
      bill: "Bill"
    }
  };

  function translatePage() {
    document.querySelectorAll('[data-lang]').forEach(el => {
      const key = el.getAttribute('data-lang');
      if(languageStrings[currentLang] && languageStrings[currentLang][key]) {
        el.innerText = languageStrings[currentLang][key];
      }
    });
    updateLoginPlaceholders();
  }

  function toggleLang() {
    currentLang = (currentLang === "mr") ? "en" : "mr";
    translatePage();
  }

  function updateLoginPlaceholders() {
    const role = document.getElementById('loginRole').value;
    const userInput = document.getElementById('loginUser');
    const passInput = document.getElementById('loginPass');
    if(currentLang === 'mr') {
      if(role==='gateman') userInput.placeholder = "‡§µ‡§æ‡§™‡§∞‡§ï‡§∞‡•ç‡§§‡§æ ‡§®‡§æ‡§µ (‡§â‡§¶‡§æ. G)";
      else if(role==='chairman') userInput.placeholder = "‡§µ‡§æ‡§™‡§∞‡§ï‡§∞‡•ç‡§§‡§æ ‡§®‡§æ‡§µ (‡§â‡§¶‡§æ. C)";
      else if(role==='billing') userInput.placeholder = "‡§µ‡§æ‡§™‡§∞‡§ï‡§∞‡•ç‡§§‡§æ ‡§®‡§æ‡§µ (‡§â‡§¶‡§æ. B)";
      else if(role==='transport') userInput.placeholder = "‡§µ‡§æ‡§™‡§∞‡§ï‡§∞‡•ç‡§§‡§æ ‡§®‡§æ‡§µ (‡§â‡§¶‡§æ. T)";
      else if(role==='farmer') userInput.placeholder = "‡§Ü‡§ß‡§æ‡§∞ ‡§®‡§Ç‡§¨‡§∞ (‡§â‡§¶‡§æ. 123456789012)";
      else if(role==='tractorOwner') userInput.placeholder = "‡§ü‡•ç‡§∞‡•Ö‡§ï‡•ç‡§ü‡§∞ ‡§®‡§Ç‡§¨‡§∞ (‡§â‡§¶‡§æ. MH12AB1234)";
      passInput.placeholder = "‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§°";
    } else {
      if(role==='gateman') userInput.placeholder = "Username (e.g. G)";
      else if(role==='chairman') userInput.placeholder = "Username (e.g. C)";
      else if(role==='billing') userInput.placeholder = "Username (e.g. B)";
      else if(role==='transport') userInput.placeholder = "Username (e.g. T)";
      else if(role==='farmer') userInput.placeholder = "Aadhar Number (e.g. 123456789012)";
      else if(role==='tractorOwner') userInput.placeholder = "Tractor Number (e.g. MH12AB1234)";
      passInput.placeholder = "Password";
    }
  }

  document.getElementById('showPass').addEventListener('change', () => {
    const passInput = document.getElementById('loginPass');
    passInput.type = document.getElementById('showPass').checked ? 'text' : 'password';
  });

  const fixedUsers = [
    { id: 'G', role: 'gateman', password: '0012' },
    { id: 'C', role: 'chairman', password: '0012' },
    { id: 'B', role: 'billing', password: '0012' },
    { id: 'T', role: 'transport', password: '0012' },
  ];

  function login() {
    const inputUser = document.getElementById('loginUser').value.trim().toUpperCase();
    const inputPass = document.getElementById('loginPass').value.trim();
    const selectedRole = document.getElementById('loginRole').value;
    const msg = document.getElementById('loginMessage');
    msg.textContent = '';

    if(!inputUser || !inputPass) {
      msg.textContent = currentLang==='mr' ? "‡§∏‡§∞‡•ç‡§µ ‡§´‡•Ä‡§≤‡•ç‡§° ‡§≠‡§∞‡§æ." : "Please fill all fields.";
      msg.classList.add("error");
      return;
    }

    let userObj = null;

    if (selectedRole === 'farmer') {
      const farmer = farmerRegistry.find(f => f.aadhar === inputUser);
      if (farmer && inputPass === '0012') {
        userObj = { id: farmer.aadhar, role: 'farmer' };
      }
    } else if (selectedRole === 'tractorOwner') {
      const tractor = tractorRegistry.find(t => t.tractorNumber === inputUser);
      if (tractor && inputPass === '0012') {
        userObj = { id: tractor.tractorNumber, role: 'tractorOwner' };
      }
    } else {
      userObj = fixedUsers.find(u => u.id.toUpperCase() === inputUser && u.password === inputPass && u.role === selectedRole);
    }

    if(!userObj) {
      msg.textContent = currentLang==='mr' ? "‡§Ö‡§µ‡•à‡§ß ‡§ï‡•ç‡§∞‡•á‡§°‡•á‡§®‡•ç‡§∂‡§ø‡§Ø‡§≤‡•ç‡§∏." : "Invalid credentials.";
      msg.classList.add("error");
      return;
    }

    currentRole = userObj.role;
    loginUser = userObj.id;
    msg.textContent = '';
    document.getElementById('loginBox').classList.add('hidden');
    document.getElementById('mainApp').classList.remove('hidden');
    showRoleSections();
    initApp();
  }

  function logout() {
    currentRole = "";
    loginUser = "";
    document.getElementById('loginBox').classList.remove('hidden');
    document.getElementById('mainApp').classList.add('hidden');
    document.getElementById('loginUser').value = '';
    document.getElementById('loginPass').value = '';
    document.getElementById('loginMessage').textContent = '';
    document.querySelectorAll('section').forEach(sec => sec.classList.add('hidden'));
  }

  function showRoleSections() {
    document.getElementById('gatemanSection').classList.add('hidden');
    document.getElementById('chairmanSection').classList.add('hidden');
    document.getElementById('transportSection').classList.add('hidden');
    document.getElementById('billingSection').classList.add('hidden');
    document.getElementById('farmerSection').classList.add('hidden');
    document.getElementById('tractorOwnerSection').classList.add('hidden');

    if(currentRole === 'gateman') document.getElementById('gatemanSection').classList.remove('hidden');
    else if(currentRole === 'chairman') document.getElementById('chairmanSection').classList.remove('hidden');
    else if(currentRole === 'transport') document.getElementById('transportSection').classList.remove('hidden');
    else if(currentRole === 'billing') document.getElementById('billingSection').classList.remove('hidden');
    else if(currentRole === 'farmer') {
      document.getElementById('farmerSection').classList.remove('hidden');
      showFarmerData();
    }
    else if(currentRole === 'tractorOwner') {
      document.getElementById('tractorOwnerSection').classList.remove('hidden');
      showTractorOwnerData();
    }
  }

  function updateClock() {
    const now = new Date();
    document.getElementById('liveClock').textContent = now.toLocaleTimeString(currentLang==='mr' ? 'mr-IN' : 'en-US');
  }
  setInterval(updateClock, 1000);
  updateClock();

  function saveAll() {
    localStorage.setItem('tractorRegistry', JSON.stringify(tractorRegistry));
    localStorage.setItem('farmerRegistry', JSON.stringify(farmerRegistry));
    localStorage.setItem('parkedTractors', JSON.stringify(parkedTractors));
    localStorage.setItem('inOutBook', JSON.stringify(inOutBook));
    localStorage.setItem('farmerSalesBook', JSON.stringify(farmerSalesBook));
    localStorage.setItem('transportHistory', JSON.stringify(transportHistory));
    localStorage.setItem('rates', JSON.stringify(rates));
  }

  function initApp() {
    updateDashboard();
    renderParkingGrid();
    renderTractorTable();
    renderFarmerTable();
    renderInOutBookTable();
    renderFarmerSalesTable();
    renderTransportHistoryTable();
    renderBillingTables();
    populateTransportDropdown();
   
    if (currentRole === 'chairman') {
      document.getElementById('sugarcaneRate').value = rates.sugarcane;
      document.getElementById('transportRate').value = rates.transport;
    }
  }

  function updateDashboard() {
    if(currentRole === 'farmer' || currentRole === 'tractorOwner') {
      document.getElementById('dashboardReport').textContent = '';
      return;
    }
   
    const parkedCount = Object.values(parkedTractors).filter(t => !t.timeOut).length;
    const today = new Date().toLocaleDateString();
    const inOutToday = inOutBook.filter(e=> e.inTime?.startsWith(today)).length;
    const sugarcaneToday = farmerSalesBook.filter(f=> f.date === today).reduce((a,b) => a + parseFloat(b.sugarcaneWeight || 0), 0);
   
    let farmerTotals = {};
    for(const sale of farmerSalesBook){
      farmerTotals[sale.farmerName] = (farmerTotals[sale.farmerName]||0) + parseFloat(sale.sugarcaneWeight || 0);
    }
    const sortedFarmers = Object.entries(farmerTotals).sort((a,b)=> b[1] - a[1]).slice(0,5);
    const topFarmersStr = sortedFarmers.length ? sortedFarmers.map(f=> `${f[0]} (${f[1].toFixed(2)} ‡§ü‡§®)`).join(', ') : (currentLang==='mr' ? '‡§®‡§æ‡§π‡•Ä' : 'None');

    let totalUnpaidFarmer = farmerSalesBook.filter(b=> !b.isPaid).reduce((sum, b) => sum + (b.billAmount || 0), 0);
    let totalUnpaidTransport = transportHistory.filter(b=> !b.isPaid).reduce((sum, b) => sum + (b.billAmount || 0), 0);

    const d = {
      mr:`üöú ‡§™‡§æ‡§∞‡•ç‡§ï ‡§ù‡§æ‡§≤‡•á‡§≤‡•á: ${parkedCount} | ‡§Ü‡§ú‡§ö‡§æ ‡§ä‡§∏: ${sugarcaneToday.toFixed(2)} ‡§ü‡§® | ‡§¶‡•á‡§Ø ‡§∂‡•á‡§§‡§ï‡§∞‡•Ä: ‚Çπ${totalUnpaidFarmer.toFixed(2)} | ‡§¶‡•á‡§Ø ‡§ü‡•ç‡§∞‡§æ‡§®‡•ç‡§∏‡§™‡•ã‡§∞‡•ç‡§ü: ‚Çπ${totalUnpaidTransport.toFixed(2)}`,
      en:`üöú Parked: ${parkedCount} | Sugarcane Today: ${sugarcaneToday.toFixed(2)} tons | Unpaid Farmer Bills: ‚Çπ${totalUnpaidFarmer.toFixed(2)} | Unpaid Transport Bills: ‚Çπ${totalUnpaidTransport.toFixed(2)}`
    };
    document.getElementById('dashboardReport').textContent = d[currentLang];
  }

  function renderParkingGrid(){
    const grid = document.getElementById('parkingGrid');
    grid.innerHTML = '';
    const maxSlots = 50;
    for(let i=1; i<=maxSlots; i++){
      let occupiedTractor = null;
      for(let tn in parkedTractors){
        if(parkedTractors[tn].slot === i && !parkedTractors[tn].timeOut){
          occupiedTractor = tn;
          break;
        }
      }
      let div = document.createElement('div');
      if(occupiedTractor){
        div.className = 'slot-box occupied';
        div.innerHTML = `Slot ${i} <br>üöú ${occupiedTractor}`;
      } else {
        div.className = 'slot-box';
        div.innerText = `Slot ${i}`;
      }
      grid.appendChild(div);
    }
  }

  function tractorIn() {
    if(currentRole !== 'gateman') { alert(currentLang==='mr' ? "‡§™‡§∞‡§µ‡§æ‡§®‡§ó‡•Ä ‡§®‡§æ‡§π‡•Ä" : "Permission denied"); return;}
    const tnum = document.getElementById('gatemanTractorNo').value.trim().toUpperCase();
    const slot = parseInt(document.getElementById('gatemanSlot').value);
    let msgEl = document.getElementById('gatemanMsg');
    msgEl.className = 'message';
    msgEl.textContent = '';

    if(!tnum || !slot || slot < 1 || slot >50){
      msgEl.textContent = currentLang==='mr' ? '‡§ï‡•É‡§™‡§Ø‡§æ ‡§µ‡•à‡§ß ‡§ü‡•ç‡§∞‡•Ö‡§ï‡•ç‡§ü‡§∞ ‡§®‡§Ç‡§¨‡§∞ ‡§Ü‡§£‡§ø ‡§∏‡•ç‡§≤‡•â‡§ü ‡§¶‡•ç‡§Ø‡§æ' : 'Enter valid tractor number and slot';
      msgEl.classList.add('error');
      return;
    }
    if(!tractorRegistry.find(t=>t.tractorNumber === tnum)){
      msgEl.textContent = currentLang==='mr' ? `‡§ü‡•ç‡§∞‡•Ö‡§ï‡•ç‡§ü‡§∞ ${tnum} ‡§®‡•ã‡§Ç‡§¶‡§£‡•Ä‡§ï‡•É‡§§ ‡§®‡§æ‡§π‡•Ä` : `Tractor ${tnum} not registered`;
      msgEl.classList.add('error');
      return;
    }
    for(let t in parkedTractors){
      if(parkedTractors[t].slot === slot && !parkedTractors[t].timeOut){
        msgEl.textContent = currentLang==='mr' ? `‡§™‡§æ‡§∞‡•ç‡§ï‡§ø‡§Ç‡§ó ‡§∏‡•ç‡§≤‡•â‡§ü ${slot} ‡§Ü‡§ß‡•Ä‡§ö ‡§µ‡•ç‡§Ø‡§æ‡§™‡§≤‡•á‡§≤‡§æ ‡§Ü‡§π‡•á` : 'Slot already occupied';
        msgEl.classList.add('error');
        return;
      }
    }
    if(parkedTractors[tnum] && !parkedTractors[tnum].timeOut) {
      msgEl.textContent = currentLang==='mr' ? '‡§ü‡•ç‡§∞‡•Ö‡§ï‡•ç‡§ü‡§∞ ‡§Ü‡§ß‡•Ä‡§ö ‡§™‡§æ‡§∞‡•ç‡§ï ‡§Ü‡§π‡•á' : 'Tractor already parked';
      msgEl.classList.add('error');
      return;
    }

    const nowStr = new Date().toLocaleString();
    parkedTractors[tnum] = { slot, timeIn: nowStr, timeOut: null};
    inOutBook.push({tractorNumber: tnum, slot, inTime: nowStr, outTime: ""});
    saveAll();
    msgEl.textContent = currentLang==='mr' ? `‡§ü‡•ç‡§∞‡•Ö‡§ï‡•ç‡§ü‡§∞ ${tnum} ‡§™‡§æ‡§∞‡•ç‡§ï‡§ø‡§Ç‡§ó ‡§∏‡•ç‡§≤‡•â‡§ü ${slot} ‡§µ‡§∞ ‡§™‡§æ‡§∞‡•ç‡§ï ‡§ï‡•á‡§≤‡§æ` : `Tractor ${tnum} parked at slot ${slot}`;
    msgEl.classList.add('success');
    document.getElementById('gatemanTractorNo').value = '';
    document.getElementById('gatemanSlot').value = '';
    initApp();
  }

  function tractorOut(){
    if(currentRole !== 'gateman') { alert(currentLang==='mr' ? "‡§™‡§∞‡§µ‡§æ‡§®‡§ó‡•Ä ‡§®‡§æ‡§π‡•Ä" : "Permission denied"); return;}
    const tnum = document.getElementById('gatemanTractorNo').value.trim().toUpperCase();
    let msgEl = document.getElementById('gatemanMsg');
    msgEl.className = 'message';
    msgEl.textContent = '';

    if(!tnum){
      msgEl.textContent = currentLang==='mr' ? '‡§ü‡•ç‡§∞‡•Ö‡§ï‡•ç‡§ü‡§∞ ‡§®‡§Ç‡§¨‡§∞ ‡§™‡•ç‡§∞‡§µ‡§ø‡§∑‡•ç‡§ü ‡§ï‡§∞‡§æ' : 'Enter tractor number';
      msgEl.classList.add('error');
      return;
    }
    if(!tractorRegistry.find(t=>t.tractorNumber === tnum)){
      msgEl.textContent = currentLang==='mr' ? '‡§ü‡•ç‡§∞‡•Ö‡§ï‡•ç‡§ü‡§∞ ‡§®‡•ã‡§Ç‡§¶‡§£‡•Ä‡§ï‡•É‡§§ ‡§®‡§æ‡§π‡•Ä' : 'Tractor not registered';
      msgEl.classList.add('error');
      return;
    }
    if(!parkedTractors[tnum] || parkedTractors[tnum].timeOut){
      msgEl.textContent = currentLang==='mr' ? '‡§ü‡•ç‡§∞‡•Ö‡§ï‡•ç‡§ü‡§∞ ‡§∏‡§ß‡•ç‡§Ø‡§æ ‡§™‡§æ‡§∞‡•ç‡§ï ‡§®‡§æ‡§π‡•Ä' : 'Tractor not currently parked';
      msgEl.classList.add('error');
      return;
    }

    const nowStr = new Date().toLocaleString();
    parkedTractors[tnum].timeOut = nowStr;
    for(let i=inOutBook.length-1;i>=0;i--){
      if(inOutBook[i].tractorNumber === tnum && inOutBook[i].outTime === ""){
        inOutBook[i].outTime = nowStr;
        break;
      }
    }
    saveAll();
    msgEl.textContent = currentLang==='mr' ? `‡§ü‡•ç‡§∞‡•Ö‡§ï‡•ç‡§ü‡§∞ ${tnum} ‡§™‡§æ‡§∞‡•ç‡§ï‡§ø‡§Ç‡§ó‡§Æ‡§ß‡•Ç‡§® ‡§¨‡§æ‡§π‡•á‡§∞ ‡§™‡§°‡§≤‡§æ` : `Tractor ${tnum} left the parking`;
    msgEl.classList.add('success');
    document.getElementById('gatemanTractorNo').value = '';
    initApp();
  }

  // Chairman Functions
  function renderTractorTable(filterText = '') {
    const tableBody = document.querySelector('#tractorTable tbody');
    tableBody.innerHTML = '';
    const filteredTractors = tractorRegistry.filter(t => t.tractorNumber.includes(filterText.toUpperCase()));
    filteredTractors.forEach((t, index) => {
      const row = tableBody.insertRow();
      row.insertCell(0).innerText = t.owner;
      row.insertCell(1).innerText = t.tractorNumber;
      row.insertCell(2).innerText = t.weight + ' kg';
      row.insertCell(3).innerText = t.model;
      const editCell = row.insertCell(4);
      const deleteCell = row.insertCell(5);
      editCell.innerHTML = `<button onclick="editTractor('${t.tractorNumber}')" class="btn-warning">Edit</button>`;
      deleteCell.innerHTML = `<button onclick="deleteTractor('${t.tractorNumber}')" class="btn-danger">Delete</button>`;
    });
  }

  function filterTractors(){
    const searchText = document.getElementById('chairmanTractorSearch').value;
    renderTractorTable(searchText);
  }

  function saveTractor() {
    const owner = document.getElementById('chairmanOwner').value.trim();
    const number = document.getElementById('chairmanTractorNo').value.trim().toUpperCase();
    const weight = document.getElementById('chairmanWeight').value.trim();
    const model = document.getElementById('chairmanModel').value.trim();
    const msgEl = document.getElementById('tractorMsg');
    const editingIndex = document.getElementById('editingTractorIndex').value;
    msgEl.textContent = '';
   
    if(!owner || !number || !weight || !model){
      msgEl.textContent = currentLang==='mr' ? "‡§∏‡§∞‡•ç‡§µ ‡§Æ‡§æ‡§π‡§ø‡§§‡•Ä ‡§≠‡§∞‡§æ" : "Please fill all fields";
      msgEl.classList.add('error');
      return;
    }
   
    if(editingIndex != -1){
      tractorRegistry[editingIndex] = {owner, tractorNumber: number, weight, model};
      msgEl.textContent = currentLang==='mr' ? "‡§ü‡•ç‡§∞‡•Ö‡§ï‡•ç‡§ü‡§∞ ‡§Æ‡§æ‡§π‡§ø‡§§‡•Ä ‡§Ö‡§™‡§°‡•á‡§ü ‡§ù‡§æ‡§≤‡•Ä" : "Tractor info updated";
    } else {
      const existing = tractorRegistry.find(t=> t.tractorNumber === number);
      if(existing){
        msgEl.textContent = currentLang==='mr' ? "‡§π‡§æ ‡§ü‡•ç‡§∞‡•Ö‡§ï‡•ç‡§ü‡§∞ ‡§®‡§Ç‡§¨‡§∞ ‡§Ü‡§ß‡•Ä‡§ö ‡§®‡•ã‡§Ç‡§¶‡§£‡•Ä‡§ï‡•É‡§§ ‡§Ü‡§π‡•á" : "Tractor number already registered";
        msgEl.classList.add('error');
        return;
      }
      tractorRegistry.push({owner, tractorNumber: number, weight, model});
      msgEl.textContent = currentLang==='mr' ? "‡§ü‡•ç‡§∞‡•Ö‡§ï‡•ç‡§ü‡§∞ ‡§®‡•ã‡§Ç‡§¶‡§£‡•Ä ‡§ù‡§æ‡§≤‡•Ä" : "Tractor registered";
    }

    msgEl.classList.add('success');
    document.getElementById('chairmanOwner').value = '';
    document.getElementById('chairmanTractorNo').value = '';
    document.getElementById('chairmanWeight').value = '';
    document.getElementById('chairmanModel').value = '';
    document.getElementById('editingTractorIndex').value = -1;
    saveAll();
    renderTractorTable();
    populateTransportDropdown();
  }

  function editTractor(number) {
    const index = tractorRegistry.findIndex(t => t.tractorNumber === number);
    if(index === -1) return;
    const tractor = tractorRegistry[index];
    document.getElementById('chairmanOwner').value = tractor.owner;
    document.getElementById('chairmanTractorNo').value = tractor.tractorNumber;
    document.getElementById('chairmanWeight').value = tractor.weight;
    document.getElementById('chairmanModel').value = tractor.model;
    document.getElementById('editingTractorIndex').value = index;
  }

  function deleteTractor(number) {
    if(confirm(currentLang==='mr' ? "‡§§‡•Å‡§Æ‡•ç‡§π‡•Ä ‡§π‡§æ ‡§ü‡•ç‡§∞‡•Ö‡§ï‡•ç‡§ü‡§∞ ‡§π‡§ü‡§µ‡•Ç ‡§á‡§ö‡•ç‡§õ‡§ø‡§§‡§æ?" : "Are you sure you want to delete this tractor?")){
      tractorRegistry = tractorRegistry.filter(t => t.tractorNumber !== number);
      saveAll();
      renderTractorTable();
      populateTransportDropdown();
    }
  }

  function renderFarmerTable(filterText = '') {
    const tableBody = document.querySelector('#farmerTable tbody');
    tableBody.innerHTML = '';
    const filteredFarmers = farmerRegistry.filter(f => f.name.toLowerCase().includes(filterText.toLowerCase()));
    filteredFarmers.forEach((f, index) => {
      const row = tableBody.insertRow();
      row.insertCell(0).innerText = f.name;
      row.insertCell(1).innerText = f.aadhar;
      row.insertCell(2).innerText = f.mobile;
      const editCell = row.insertCell(3);
      const deleteCell = row.insertCell(4);
      editCell.innerHTML = `<button onclick="editFarmer('${f.aadhar}')" class="btn-warning">Edit</button>`;
      deleteCell.innerHTML = `<button onclick="deleteFarmer('${f.aadhar}')" class="btn-danger">Delete</button>`;
    });
  }

  function filterFarmers() {
    const searchText = document.getElementById('chairmanFarmerSearch').value;
    renderFarmerTable(searchText);
  }

  function saveFarmer() {
    const name = document.getElementById('chairmanFarmerName').value.trim();
    const aadhar = document.getElementById('chairmanFarmerAadhar').value.trim();
    const shetiGatNo = document.getElementById('chairmanShetiGatNo').value.trim();
    const mobile = document.getElementById('chairmanMobile').value.trim();
    const accountNo = document.getElementById('chairmanAccountNo').value.trim();
    const bankName = document.getElementById('chairmanBankName').value.trim();
    const ifsc = document.getElementById('chairmanIFSC').value.trim();
    const msgEl = document.getElementById('farmerMsg');
    const editingIndex = document.getElementById('editingFarmerIndex').value;
    msgEl.textContent = '';

    if(!name || !aadhar){
      msgEl.textContent = currentLang==='mr' ? "‡§®‡§æ‡§µ ‡§Ü‡§£‡§ø ‡§Ü‡§ß‡§æ‡§∞ ‡§®‡§Ç‡§¨‡§∞ ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï ‡§Ü‡§π‡•á" : "Name and Aadhar are required";
      msgEl.classList.add('error');
      return;
    }
   
    if(editingIndex != -1){
      farmerRegistry[editingIndex] = {name, aadhar, shetiGatNo, mobile, accountNo, bankName, ifsc};
      msgEl.textContent = currentLang==='mr' ? "‡§∂‡•á‡§§‡§ï‡§∞‡•Ä ‡§Æ‡§æ‡§π‡§ø‡§§‡•Ä ‡§Ö‡§™‡§°‡•á‡§ü ‡§ù‡§æ‡§≤‡•Ä" : "Farmer info updated";
    } else {
      const existing = farmerRegistry.find(f => f.aadhar === aadhar);
      if(existing){
        msgEl.textContent = currentLang==='mr' ? "‡§π‡§æ ‡§Ü‡§ß‡§æ‡§∞ ‡§®‡§Ç‡§¨‡§∞ ‡§Ü‡§ß‡•Ä‡§ö ‡§®‡•ã‡§Ç‡§¶‡§£‡•Ä‡§ï‡•É‡§§ ‡§Ü‡§π‡•á" : "Aadhar number already registered";
        msgEl.classList.add('error');
        return;
      }
      farmerRegistry.push({name, aadhar, shetiGatNo, mobile, accountNo, bankName, ifsc});
      msgEl.textContent = currentLang==='mr' ? "‡§∂‡•á‡§§‡§ï‡§∞‡•Ä ‡§®‡•ã‡§Ç‡§¶‡§£‡•Ä ‡§ù‡§æ‡§≤‡•Ä" : "Farmer registered";
    }

    msgEl.classList.add('success');
    document.getElementById('chairmanFarmerName').value = '';
    document.getElementById('chairmanFarmerAadhar').value = '';
    document.getElementById('chairmanShetiGatNo').value = '';
    document.getElementById('chairmanMobile').value = '';
    document.getElementById('chairmanAccountNo').value = '';
    document.getElementById('chairmanBankName').value = '';
    document.getElementById('chairmanIFSC').value = '';
    document.getElementById('editingFarmerIndex').value = -1;
    saveAll();
    renderFarmerTable();
  }

  function editFarmer(aadhar) {
    const index = farmerRegistry.findIndex(f => f.aadhar === aadhar);
    if(index === -1) return;
    const farmer = farmerRegistry[index];
    document.getElementById('chairmanFarmerName').value = farmer.name;
    document.getElementById('chairmanFarmerAadhar').value = farmer.aadhar;
    document.getElementById('chairmanShetiGatNo').value = farmer.shetiGatNo;
    document.getElementById('chairmanMobile').value = farmer.mobile;
    document.getElementById('chairmanAccountNo').value = farmer.accountNo;
    document.getElementById('chairmanBankName').value = farmer.bankName;
    document.getElementById('chairmanIFSC').value = farmer.ifsc;
    document.getElementById('editingFarmerIndex').value = index;
  }

  function deleteFarmer(aadhar) {
    if(confirm(currentLang==='mr' ? "‡§§‡•Å‡§Æ‡•ç‡§π‡•Ä ‡§π‡§æ ‡§∂‡•á‡§§‡§ï‡§∞‡•Ä ‡§π‡§ü‡§µ‡•Ç ‡§á‡§ö‡•ç‡§õ‡§ø‡§§‡§æ?" : "Are you sure you want to delete this farmer?")){
      farmerRegistry = farmerRegistry.filter(f => f.aadhar !== aadhar);
      saveAll();
      renderFarmerTable();
    }
  }

  function renderInOutBookTable() {
    const tableBody = document.querySelector('#inOutBookTable tbody');
    tableBody.innerHTML = '';
    inOutBook.forEach(entry => {
      const row = tableBody.insertRow();
      row.insertCell(0).innerText = entry.tractorNumber;
      row.insertCell(1).innerText = entry.slot;
      row.insertCell(2).innerText = entry.inTime;
      row.insertCell(3).innerText = entry.outTime || 'N/A';
    });
  }

  function renderFarmerSalesTable() {
    const tableBody = document.querySelector('#farmerSalesTable tbody');
    tableBody.innerHTML = '';
    farmerSalesBook.forEach(sale => {
      const row = tableBody.insertRow();
      row.insertCell(0).innerText = sale.farmerName;
      row.insertCell(1).innerText = sale.sugarcaneWeight;
      row.insertCell(2).innerText = sale.date;
    });
  }

  // Transport Functions
  function populateTransportDropdown(){
    const select = document.getElementById('transportTractorSelect');
    select.innerHTML = `<option value="">${currentLang === 'mr' ? '‡§ü‡•ç‡§∞‡•Ö‡§ï‡•ç‡§ü‡§∞ ‡§®‡§ø‡§µ‡§°‡§æ' : 'Select Tractor'}</option>`;
    tractorRegistry.forEach(t => {
      const option = document.createElement('option');
      option.value = t.tractorNumber;
      option.textContent = t.tractorNumber + ' (' + t.owner + ')';
      select.appendChild(option);
    });
  }

  function generateTransportBill() {
    const tractorNumber = document.getElementById('transportTractorSelect').value;
    const farmerName = document.getElementById('transportFarmerName').value.trim();
    const sugarcaneWeight = parseFloat(document.getElementById('transportSugarcaneWeight').value);
    const distance = parseFloat(document.getElementById('transportDistance').value);
    const diesel = parseFloat(document.getElementById('transportDiesel').value);
    const msgEl = document.getElementById('transportMsg');
    msgEl.textContent = '';
    msgEl.className = 'message';

    if(!tractorNumber || !farmerName || isNaN(sugarcaneWeight) || isNaN(distance) || isNaN(diesel) || sugarcaneWeight <= 0 || distance <= 0){
      msgEl.textContent = currentLang==='mr' ? "‡§∏‡§∞‡•ç‡§µ ‡§Æ‡§æ‡§π‡§ø‡§§‡•Ä ‡§Ø‡•ã‡§ó‡•ç‡§Ø ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞‡•á ‡§≠‡§∞‡§æ" : "Please fill all fields correctly";
      msgEl.classList.add('error');
      return;
    }

    const billAmount = distance * rates.transport - diesel * 90; // Assuming diesel price is 90 Rs/litre
    const billDetails = {
      tractorNumber,
      farmerName,
      sugarcaneWeight,
      distance,
      diesel,
      date: new Date().toLocaleDateString(),
      billAmount: billAmount,
      isPaid: false,
      paymentMethod: null
    };

    transportHistory.push(billDetails);
    saveAll();
    msgEl.textContent = currentLang==='mr' ? `‡§ü‡•ç‡§∞‡§æ‡§®‡•ç‡§∏‡§™‡•ã‡§∞‡•ç‡§ü ‡§¨‡§ø‡§≤ ‡§§‡§Ø‡§æ‡§∞ ‡§ù‡§æ‡§≤‡•á. ‡§∞‡§ï‡•ç‡§ï‡§Æ: ‚Çπ${billAmount.toFixed(2)}` : `Transport bill generated. Amount: ‚Çπ${billAmount.toFixed(2)}`;
    msgEl.classList.add('success');
    renderTransportHistoryTable();
    initApp();
  }
 
  function generateFarmerBill(){
    const farmerName = document.getElementById('transportFarmerName').value.trim();
    const sugarcaneWeight = parseFloat(document.getElementById('transportSugarcaneWeight').value);
    const msgEl = document.getElementById('transportMsg');
    msgEl.textContent = '';
    msgEl.className = 'message';
   
    if(!farmerName || isNaN(sugarcaneWeight) || sugarcaneWeight <= 0){
      msgEl.textContent = currentLang==='mr' ? "‡§∂‡•á‡§§‡§ï‡§±‡•ç‡§Ø‡§æ‡§ö‡•á ‡§®‡§æ‡§µ ‡§Ü‡§£‡§ø ‡§â‡§∏‡§æ‡§ö‡•á ‡§µ‡§ú‡§® ‡§Ø‡•ã‡§ó‡•ç‡§Ø ‡§≠‡§∞‡§æ" : "Please enter valid farmer name and sugarcane weight";
      msgEl.classList.add('error');
      return;
    }
   
    const billAmount = sugarcaneWeight * rates.sugarcane;
    const billDetails = {
      farmerName,
      sugarcaneWeight,
      date: new Date().toLocaleDateString(),
      billAmount: billAmount,
      isPaid: false,
      paymentMethod: null
    };
   
    farmerSalesBook.push(billDetails);
    saveAll();
    msgEl.textContent = currentLang==='mr' ? `‡§∂‡•á‡§§‡§ï‡§∞‡•Ä ‡§¨‡§ø‡§≤ ‡§§‡§Ø‡§æ‡§∞ ‡§ù‡§æ‡§≤‡•á. ‡§∞‡§ï‡•ç‡§ï‡§Æ: ‚Çπ${billAmount.toFixed(2)}` : `Farmer bill generated. Amount: ‚Çπ${billAmount.toFixed(2)}`;
    msgEl.classList.add('success');
    renderFarmerSalesTable();
    initApp();
  }

  function renderTransportHistoryTable() {
    const tableBody = document.querySelector('#transportHistoryTable tbody');
    tableBody.innerHTML = '';
    transportHistory.forEach(entry => {
      const row = tableBody.insertRow();
      row.insertCell(0).innerText = entry.tractorNumber;
      row.insertCell(1).innerText = entry.farmerName;
      row.insertCell(2).innerText = entry.sugarcaneWeight;
      row.insertCell(3).innerText = entry.distance;
      row.insertCell(4).innerText = entry.diesel;
      row.insertCell(5).innerText = entry.date;
    });
  }

  function printBill(type) {
    let billHTML = '';
    const billDate = new Date().toLocaleDateString();
   
    if (type === 'transport') {
        const lastBill = transportHistory[transportHistory.length - 1];
        if (!lastBill) {
            alert(currentLang === 'mr' ? '‡§Ü‡§ß‡•Ä ‡§¨‡§ø‡§≤ ‡§§‡§Ø‡§æ‡§∞ ‡§ï‡§∞‡§æ.' : 'Please generate a bill first.');
            return;
        }
        billHTML = `
            <h2>${currentLang === 'mr' ? '‡§ü‡•ç‡§∞‡§æ‡§®‡•ç‡§∏‡§™‡•ã‡§∞‡•ç‡§ü ‡§¨‡§ø‡§≤' : 'Transport Bill'}</h2>
            <p><strong>${currentLang === 'mr' ? '‡§§‡§æ‡§∞‡•Ä‡§ñ' : 'Date'}:</strong> ${billDate}</p>
            <p><strong>${currentLang === 'mr' ? '‡§ü‡•ç‡§∞‡•Ö‡§ï‡•ç‡§ü‡§∞ ‡§®‡§Ç‡§¨‡§∞' : 'Tractor Number'}:</strong> ${lastBill.tractorNumber}</p>
            <p><strong>${currentLang === 'mr' ? '‡§∂‡•á‡§§‡§ï‡§±‡•ç‡§Ø‡§æ‡§ö‡•á ‡§®‡§æ‡§µ' : 'Farmer Name'}:</strong> ${lastBill.farmerName}</p>
            <p><strong>${currentLang === 'mr' ? '‡§â‡§∏‡§æ‡§ö‡•á ‡§µ‡§ú‡§® (‡§ü‡§®)' : 'Sugarcane Weight (tons)'}:</strong> ${lastBill.sugarcaneWeight}</p>
            <p><strong>${currentLang === 'mr' ? '‡§Ö‡§Ç‡§§‡§∞ (‡§ï‡§ø‡§Æ‡•Ä)' : 'Distance (km)'}:</strong> ${lastBill.distance}</p>
            <p><strong>${currentLang === 'mr' ? '‡§è‡§ï‡•Ç‡§£ ‡§∞‡§ï‡•ç‡§ï‡§Æ' : 'Total Amount'}:</strong> ‚Çπ${lastBill.billAmount.toFixed(2)}</p>
        `;
    } else if (type === 'farmer') {
        const lastBill = farmerSalesBook[farmerSalesBook.length - 1];
        if (!lastBill) {
            alert(currentLang === 'mr' ? '‡§Ü‡§ß‡•Ä ‡§¨‡§ø‡§≤ ‡§§‡§Ø‡§æ‡§∞ ‡§ï‡§∞‡§æ.' : 'Please generate a bill first.');
            return;
        }
        billHTML = `
            <h2>${currentLang === 'mr' ? '‡§∂‡•á‡§§‡§ï‡§∞‡•Ä ‡§¨‡§ø‡§≤' : 'Farmer Bill'}</h2>
            <p><strong>${currentLang === 'mr' ? '‡§§‡§æ‡§∞‡•Ä‡§ñ' : 'Date'}:</strong> ${billDate}</p>
            <p><strong>${currentLang === 'mr' ? '‡§∂‡•á‡§§‡§ï‡§±‡•ç‡§Ø‡§æ‡§ö‡•á ‡§®‡§æ‡§µ' : 'Farmer Name'}:</strong> ${lastBill.farmerName}</p>
            <p><strong>${currentLang === 'mr' ? '‡§â‡§∏‡§æ‡§ö‡•á ‡§µ‡§ú‡§® (‡§ü‡§®)' : 'Sugarcane Weight (tons)'}:</strong> ${lastBill.sugarcaneWeight}</p>
            <p><strong>${currentLang === 'mr' ? '‡§è‡§ï‡•Ç‡§£ ‡§∞‡§ï‡•ç‡§ï‡§Æ' : 'Total Amount'}:</strong> ‚Çπ${lastBill.billAmount.toFixed(2)}</p>
        `;
    }

    const printWindow = window.open('', '_blank');
    printWindow.document.write('<html><head><title>Bill</title></head><body>');
    printWindow.document.write(billHTML);
    printWindow.document.write('</body></html>');
    printWindow.document.close();
    printWindow.print();
  }

  // Billing functions
  function renderBillingTables() {
    const farmerTableBody = document.querySelector('#billingFarmerTable tbody');
    farmerTableBody.innerHTML = '';
   
    farmerSalesBook.forEach((bill, index) => {
      const row = farmerTableBody.insertRow();
      row.insertCell(0).innerText = bill.farmerName;
      row.insertCell(1).innerText = bill.sugarcaneWeight;
      row.insertCell(2).innerText = `‚Çπ${bill.billAmount.toFixed(2)}`;
     
      const statusCell = row.insertCell(3);
      if (bill.isPaid === true) {
        statusCell.innerHTML = `<span class="paid-bank">${currentLang === 'mr' ? '‡§≠‡§∞‡§≤‡•á (‡§¨‡§Å‡§ï)' : 'Paid (Bank)'}</span>`;
      } else if (bill.paymentMethod === 'cash') {
        statusCell.innerHTML = `<span class="paid-cash">${currentLang === 'mr' ? '‡§≠‡§∞‡§≤‡•á (‡§ï‡•Ö‡§∂)' : 'Paid (Cash)'}</span>`;
      } else {
        statusCell.innerHTML = `<span class="unpaid">${currentLang === 'mr' ? '‡§¶‡•á‡§Ø' : 'Unpaid'}</span>`;
      }
     
      const actionCell = row.insertCell(4);
      if (!bill.isPaid && bill.paymentMethod !== 'cash') {
        actionCell.innerHTML = `
          <button onclick="markFarmerBillAsPaid(${index}, 'bank')" class="btn-success">Bank</button>
          <button onclick="markFarmerBillAsPaid(${index}, 'cash')" class="btn-warning">Cash</button>
        `;
      } else {
        actionCell.innerText = '‚úÖ';
      }
    });

    const tractorTableBody = document.querySelector('#billingTractorTable tbody');
    tractorTableBody.innerHTML = '';
   
    transportHistory.forEach((bill, index) => {
      const row = tractorTableBody.insertRow();
      row.insertCell(0).innerText = bill.tractorNumber;
      row.insertCell(1).innerText = `‚Çπ${bill.billAmount.toFixed(2)}`;
     
      const statusCell = row.insertCell(2);
      if (bill.isPaid === true) {
        statusCell.innerHTML = `<span class="paid-bank">${currentLang === 'mr' ? '‡§≠‡§∞‡§≤‡•á (‡§¨‡§Å‡§ï)' : 'Paid (Bank)'}</span>`;
      } else if (bill.paymentMethod === 'cash') {
        statusCell.innerHTML = `<span class="paid-cash">${currentLang === 'mr' ? '‡§≠‡§∞‡§≤‡•á (‡§ï‡•Ö‡§∂)' : 'Paid (Cash)'}</span>`;
      } else {
        statusCell.innerHTML = `<span class="unpaid">${currentLang === 'mr' ? '‡§¶‡•á‡§Ø' : 'Unpaid'}</span>`;
      }
     
      const actionCell = row.insertCell(3);
      if (!bill.isPaid && bill.paymentMethod !== 'cash') {
        actionCell.innerHTML = `
          <button onclick="markTractorBillAsPaid(${index}, 'bank')" class="btn-success">Bank</button>
          <button onclick="markTractorBillAsPaid(${index}, 'cash')" class="btn-warning">Cash</button>
        `;
      } else {
        actionCell.innerText = '‚úÖ';
      }
    });
  }

  function markFarmerBillAsPaid(index, method) {
    if (index >= 0 && index < farmerSalesBook.length) {
        farmerSalesBook[index].isPaid = (method === 'bank');
        farmerSalesBook[index].paymentMethod = method;
        saveAll();
        renderBillingTables();
        updateDashboard();
    }
  }
 
  function markTractorBillAsPaid(index, method) {
    if (index >= 0 && index < transportHistory.length) {
        transportHistory[index].isPaid = (method === 'bank');
        transportHistory[index].paymentMethod = method;
        saveAll();
        renderBillingTables();
        updateDashboard();
    }
  }

  // Farmer & Tractor Owner Sections
  function showFarmerData() {
    const farmer = farmerRegistry.find(f => f.aadhar === loginUser);
    if(farmer){
      document.getElementById('farmerLoginName').innerText = farmer.name;
     
      // Show sales
      const salesTableBody = document.querySelector('#farmerOwnSalesTable tbody');
      salesTableBody.innerHTML = '';
      const farmerSales = farmerSalesBook.filter(s => s.farmerName === farmer.name);
      farmerSales.forEach(sale => {
        const row = salesTableBody.insertRow();
        row.insertCell(0).innerText = sale.sugarcaneWeight;
        row.insertCell(1).innerText = `‚Çπ${sale.billAmount.toFixed(2)}`;
        const statusCell = row.insertCell(2);
        if (sale.isPaid === true) {
            statusCell.innerHTML = `<span class="paid-bank">Paid (Bank)</span>`;
        } else if (sale.paymentMethod === 'cash') {
            statusCell.innerHTML = `<span class="paid-cash">Paid (Cash)</span>`;
        } else {
            statusCell.innerHTML = `<span class="unpaid">Unpaid</span>`;
        }
        row.insertCell(3).innerText = sale.date;
      });

      // Show parking
      const parkingTableBody = document.querySelector('#farmerTractorParkingTable tbody');
      parkingTableBody.innerHTML = '';
      const ownerTractors = tractorRegistry.filter(t => t.owner === farmer.name);
      ownerTractors.forEach(t => {
        const parkingRecords = inOutBook.filter(i => i.tractorNumber === t.tractorNumber);
        parkingRecords.forEach(p => {
            const row = parkingTableBody.insertRow();
            row.insertCell(0).innerText = p.tractorNumber;
            row.insertCell(1).innerText = p.slot;
            row.insertCell(2).innerText = p.inTime;
            row.insertCell(3).innerText = p.outTime || 'Currently Parked';
        });
      });

    }
  }
 
  function showTractorOwnerData() {
    const tractor = tractorRegistry.find(t => t.tractorNumber === loginUser);
    if(tractor){
      document.getElementById('tractorOwnerLoginName').innerText = tractor.owner;

      // Show parking
      const parkingTableBody = document.querySelector('#ownerTractorParkingTable tbody');
      parkingTableBody.innerHTML = '';
      const tractorBills = transportHistory.filter(h => h.tractorNumber === tractor.tractorNumber);

      tractorBills.forEach(bill => {
          const row = parkingTableBody.insertRow();
          row.insertCell(0).innerText = bill.tractorNumber;
          row.insertCell(1).innerText = `‚Çπ${bill.billAmount.toFixed(2)}`;
          const statusCell = row.insertCell(2);
          if (bill.isPaid === true) {
              statusCell.innerHTML = `<span class="paid-bank">Paid (Bank)</span>`;
          } else if (bill.paymentMethod === 'cash') {
              statusCell.innerHTML = `<span class="paid-cash">Paid (Cash)</span>`;
          } else {
              statusCell.innerHTML = `<span class="unpaid">Unpaid</span>`;
          }
          row.insertCell(3).innerText = bill.date;
          row.insertCell(4).innerText = bill.outTime || 'N/A'; // Since outTime is not in transport history, this part needs adjustment
      });
    }
  }


  function saveRates() {
      rates.sugarcane = parseFloat(document.getElementById('sugarcaneRate').value);
      rates.transport = parseFloat(document.getElementById('transportRate').value);
      saveAll();
      const msgEl = document.getElementById('rateMsg');
      msgEl.textContent = currentLang === 'mr' ? '‡§¶‡§∞ ‡§Ø‡§∂‡§∏‡•ç‡§µ‡•Ä‡§∞‡§ø‡§§‡•ç‡§Ø‡§æ ‡§∏‡•á‡§µ‡•ç‡§π ‡§ï‡•á‡§≤‡•á!' : 'Rates saved successfully!';
      msgEl.classList.add('success');
      setTimeout(() => msgEl.textContent = '', 3000);
      updateDashboard();
  }

  // Initial call to set up the page
  translatePage();

</script>

</body>
</html>


